---
title: "Black Sea"
author: "Susan VanderPlas"
date: "July 3, 2018"
output: html_document
---

```{r setup, include=FALSE, echo = F, warning = F, message = F}
knitr::opts_chunk$set(echo = F, warning = F, message = F, dpi = 300)

# source("../worldfactbook.R")
load("../Data/factbook.Rdata")

library(ggthemes)
library(ggmap)
library(ggrepel)
library(ggalt)

library(rworldmap)
library(sp)
library(proj4)
library(rgdal)
library(RgoogleMaps)
library(geojsonio)

library(tidyverse)

world <- geojson_read("https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json", method = "web", what = "sp")
world_data <- data_frame(
  name = as.character(world@data$name),
  id = rownames(world@data)
)

world_map <- fortify(world) %>%
  left_join(world_data)
rm(world_data)
world <- map_data("world")
world2 <- map_data("world2")

load("../Data/Salinity.Rdata")
load("../Data/SeaBorders.Rdata")
```

## Seven countries border the Black Sea


### Pictures

#### Subject-related

<img src="picture_subject_related.jpg" width="60%"/>
<!-- Source: https://upload.wikimedia.org/wikipedia/commons/5/5f/Zonguldak_58.jpg-->

#### Subject-unrelated

<img src="picture_subject_unrelated.jpg" width="60%"/>
<!-- Source: https://upload.wikimedia.org/wikipedia/commons/0/0d/River-Nile-near-Aswan.jpg -->

### Charts

#### Subject-related, Topic-unrelated

```{r, out.width = "60%"}
salinity %>%
  filter(type %in% c("Mediterranean sea", "Inland sea", "Ocean")) %>%
  filter(name != "Pacific Ocean") %>%
ggplot() + 
  geom_col(aes(x = name, y = salinity_num, fill = name)) + 
  ggtitle("Salinity of Eurasian Bodies of Water") + 
  xlab("") + 
  scale_y_continuous("Salinity (g/kg)") + 
  scale_fill_discrete(guide = F) 
```

#### Subject-unrelated, Topic-unrelated

```{r, out.width = "60%"}
areas %>%
  right_join(
    filter(location, simple == "Africa"),
    by = c("abbr", "name")
  ) %>%
  filter(!name %in% c("World", "European Union", "Antarctica") & ! str_detect(name, "Ocean")) %>%
  mutate(name = str_replace(name, "Congo, Democratic Republic of the", "Democratic Republic of the Congo")) %>%
  mutate(name = str_replace_all(name, " ", "\n") %>% str_replace("of\nthe\n", "of the ")) %>%
  arrange(desc(total)) %>%
  mutate(land = ifelse(is.na(land), total, land),
         water = ifelse(is.na(water), 0, water)) %>%
  filter(row_number() <= 10) %>%
  mutate(name = factor(name, levels = name)) %>%
  gather(key = type, value = value, land, water) %>% 
  mutate(type = factor(type, levels = c("water", "land"))) %>%
  ggplot() + 
  geom_col(aes(x = name, y = value, fill = type)) + 
  xlab("") + 
  ylab("Area (square km)") + 
  scale_fill_manual(guide = F, values = c("steelblue1", "springgreen4")) + 
  ggtitle("Largest 10 Countries in Africa, by Total Area")
```

#### Subject-related, Topic-related (Probative)

```{r, out.width = "60%"}

bs_boundaries %>%
  arrange(length) %>%
  filter(length > 1000) %>%
  mutate(Country = factor(name, levels = name)) %>%
  ggplot() + 
  geom_col(aes(x = Country, y = length/1000)) + 
  xlab("") + 
  ylab("Length of Black Sea Coastline (km)") + 
  scale_fill_manual(guide = F, values = c("steelblue1", "springgreen4")) + 
  ggtitle("Black Sea Nations")
```

#### Subject-unrelated, Topic-related 

```{r, out.width = "60%"}

rs_boundaries %>%
  arrange(length) %>%
  filter(length > 1000) %>%
  mutate(Country = factor(name, levels = name)) %>%
  ggplot() + 
  geom_col(aes(x = Country, y = length/1000)) + 
  xlab("") + 
  ylab("Length of Red Sea Coastline (km)") + 
  scale_fill_manual(guide = F, values = c("steelblue1", "springgreen4")) + 
  ggtitle("Red Sea Nations")
```

### Maps

#### Subject-related, topic-unrelated

<img src="Subject_Related_Nonprobative_Map.jpg" width="60%"/>

#### Subject-unrelated, topic-unrelated

```{r, out.width = "60%", include = T}
africalabels <- location %>% filter(simple == "Africa") %>%
  left_join(areas) %>%
  mutate(name = str_replace(name, "Congo, (.*)", "\\1 Congo") %>%
           str_replace("^Republic of the Congo", "Republic of Congo") %>%
           str_replace("Eswatini", "Swaziland") %>%
           str_replace("Cabo Verde", "Cape Verde") %>%
           str_replace("Cote d'Ivoire", "Ivory Coast") %>%
           str_replace("Gambia, The", "Gambia") %>%
           str_replace_all(" ", "\n") %>%
           str_replace("of\nthe", "of the")
         ) %>%
  filter(land > 750000 | name == "Sudan") %>%
  mutate(label_lat = ifelse(str_detect(name, "Congo"), label_lat - 1, label_lat))
location %>% filter(simple == "Africa") %>%
  mutate(name = str_replace(name, "Congo, (.*)", "\\1 Congo") %>%
           str_replace("^Republic of the Congo", "Republic of Congo") %>%
           str_replace("Eswatini", "Swaziland") %>%
           str_replace("Cabo Verde", "Cape Verde") %>%
           str_replace("Cote d'Ivoire", "Ivory Coast") %>%
           str_replace("Gambia, The", "Gambia")) %>%
  left_join(world, by = c("name" = "region")) %>%
  ggplot() + 
  geom_polygon(aes(x = long, y = lat, group = group), fill = "white", color = "black") + 
  geom_text(aes(x = label_long, y = label_lat, label = name), data = africalabels, size = 2.5) + 
  coord_map(ylim = c(-35, 40)) + 
  theme_map()
```

#### Subject-related, topic-related (Non-probative)

```{r, out.width = "60%"}

newmap <- GetMap(center = c(44, 34.75), zoom = 6, destfile = "BlackSeaMap.png", maptype = "satellite")

```

<img src="BlackSeaMap.png" width = "60%"/>

#### Subject-unrelated, topic-related (Non-probative)

```{r, out.width = "60%"}

newmap <- GetMap(center = c(22, 38), zoom = 6, destfile = "RedSeaMap.png", maptype = "satellite")

```

<img src="RedSeaMap.png" width = "60%"/>

#### Subject-related, topic-related (probative)

```{r, out.width = "60%"}

newmap <- GetMap(center = c(44, 34.75), zoom = 5, destfile = "BlackSeaMapLabeled.png")

```

<img src="BlackSeaMapLabeled.png" width = "60%"/>
